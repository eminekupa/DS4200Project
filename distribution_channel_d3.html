<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cancellation Rate by Distribution Channel</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .bar {
      fill: steelblue;
    }
    .bar:hover {
      fill: darkorange;
    }
    .axis-label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Cancellation Rate by Distribution Channel</h2>
  <p>
    This bar chart illustrates the cancellation rate across different distribution channels used for hotel bookings in Spain. 
    As part of our broader analysis on how guest demographics and booking behaviors affect cancellations, this graph highlights 
    a clear trend: certain channels like Travel Agents tend to have much higher cancellation rates compared to others like Direct bookings. 
    This insight helps identify potential risk factors associated with specific booking methods and can guide hotels in managing 
    reservation strategies more effectively.
  </p>

  <svg width="700" height="400"></svg>

  <script>
    const svg = d3.select("svg"),
          margin = {top: 40, right: 20, bottom: 60, left: 80},
          width = +svg.attr("width") - margin.left - margin.right,
          height = +svg.attr("height") - margin.top - margin.bottom;

    const chart = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    // Loading the CSV
    d3.csv("d3_distribution_cancellation.csv").then(data => {
      data.forEach(d => {
        d.cancel_rate = +d.cancel_rate;
      });

      const x = d3.scaleBand()
          .domain(data.map(d => d.DistributionChannel))
          .range([0, width])
          .padding(0.2);

      const y = d3.scaleLinear()
          .domain([0, d3.max(data, d => d.cancel_rate)])
          .nice()
          .range([height, 0]);

      chart.append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x))
          .selectAll("text")
            .attr("transform", "rotate(-25)")
            .style("text-anchor", "end");

      chart.append("g")
          .call(d3.axisLeft(y).tickFormat(d3.format(".0%")));

      chart.selectAll(".bar")
          .data(data)
          .enter().append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d.DistributionChannel))
            .attr("y", d => y(d.cancel_rate))
            .attr("width", x.bandwidth())
            .attr("height", d => height - y(d.cancel_rate));

      // Axis labels
      svg.append("text")
        .attr("x", width / 2 + margin.left)
        .attr("y", height + margin.top + 50)
        .attr("class", "axis-label")
        .style("text-anchor", "middle")
        .text("Distribution Channel");

      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", margin.left / 3)
        .attr("x", 0 - (height / 2) - margin.top)
        .attr("dy", "1em")
        .attr("class", "axis-label")
        .style("text-anchor", "middle")
        .text("Cancellation Rate");
    });
  </script>
</body>
</html>
